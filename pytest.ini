# ============================================================================
# PYTEST CONFIGURATION - OPTIMIZED FOR DEVELOPER FLOW
# ============================================================================
# Tests should build confidence, not frustration
# This configuration creates clarity and prevents common pain points
# ============================================================================

[pytest]

# Clear boundaries prevent search anxiety
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Async should feel natural, not like a battle
asyncio_mode = auto

# ----------------------------------------------------------------------------
# OPTIONS THAT RESPECT YOUR ATTENTION
# ----------------------------------------------------------------------------
# Verbose enough to trust, quiet enough to focus
# Tracebacks that explain, not overwhelm
addopts = 
    -v                       # See every success clearly
    --tb=short               # Understand errors without drowning
    --strict-markers         # Prevent silent marker typos
    --disable-warnings       # Focus on what matters
    -p no:warnings          # Additional peace of mind
    --import-mode=importlib  # End the "plugin déjà vu" nightmare
    --show-capture=no        # Clean, uncluttered output
    --color=yes              # Successes celebrate, failures mourn clearly
    --durations=10           # Know what hurts - optimize the slowest
    --maxfail=3              # Fail fast when things go wrong

# ----------------------------------------------------------------------------
# TEST CATEGORIES WITH CLEAR INTENT
# ----------------------------------------------------------------------------
# Markers that communicate purpose, not just categorize
markers =
    # Core rhythms of testing
    unit: Fast, focused, self-contained confidence builders
    integration: Verifies connections, requires external services
    slow: Deep validation for when thoroughness matters most
    
    # Domain-specific concerns
    auth: Security gates and guardians
    database: Delicate dance with data state
    requires_respx: HTTP mocking for internal resilience proofs
    
    # New: Emotionally intelligent markers
    confidence_builder: Run these when you need a quick win
    risk_mitigation: Prevents the scenarios that cause anxiety
    refactor_safe: Your courage to change implementation

# ----------------------------------------------------------------------------
# PROTECTED MENTAL SPACE
# ----------------------------------------------------------------------------
# Filter noise, keep signals that matter
filterwarnings =
    ignore::DeprecationWarning    # Silence the past
    ignore::UserWarning           # Trust your own code
    ignore::pytest.PytestUnhandledThreadExceptionWarning  # Async serenity
    ignore::FutureWarning         # Future-proofing noise
    ignore::ResourceWarning       # Resource peace
    
    # Important signals always get through
    # error::  # Errors still demand attention
    # always::ImportWarning  # Import issues matter immediately

# ----------------------------------------------------------------------------
# PERFORMANCE THAT FEELS RESPONSIVE
# ----------------------------------------------------------------------------
# Testing should feel fast, not like waiting
test_dirs = 
    tests
    src  # Discover doctests in source for comprehensive coverage

# ----------------------------------------------------------------------------
# ENVIRONMENT-AWARE DEFAULTS
# ----------------------------------------------------------------------------
# Uncomment for CI: Strict, fast-failing, structured reporting
# [tool:pytest.ci]
# addopts = 
#     --strict
#     --maxfail=2
#     --junitxml=test-results.xml
#     --cov-report=xml

# Uncomment for local: Fast feedback, fix what broke first
# [tool:pytest.local]
# addopts = 
#     --lf  # Last failed first - maintain momentum
#     --ff  # Then run the rest
#     --new-first  # New code gets attention first
#     -p no:cov  # Skip coverage for speed

# ----------------------------------------------------------------------------
# FINAL GUARDIAN
# ----------------------------------------------------------------------------
# When debugging deep issues, override with:
# [tool:pytest.debug]
# filterwarnings = default
# addopts += --showlocals --full-trace

# ============================================================================
# Tests are conversations with your future self
# Make them clear, kind, and confidence-building
# ============================================================================
